name: Deploy / Asset Bundle

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:
    inputs:
      target:
        description: 'Deployment target (dev|staging|prod)'
        required: true
        default: 'dev'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Create asset bundle (zip)
        run: |
          zip -r repo-asset-bundle.zip \
            backend/ \
            .github/ \
            requirements.txt \
            pytest.ini \
            README.md \
            .env.example \
            -x "*.pyc" -x "*__pycache__*" -x "*.git*"
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: repo-asset-bundle
          path: repo-asset-bundle.zip
          retention-days: 30
      
      - name: Deploy summary
        env:
          TARGET: ${{ github.event.inputs.target || 'dev' }}
        run: |
          echo "Asset bundle created successfully"
          echo "Artifact: repo-asset-bundle.zip"
          echo "Target environment: $TARGET"
          echo ""
          echo "To deploy, download the artifact and:"
          echo "1. Extract the zip file"
          echo "2. Deploy to Databricks Apps or your target platform"
          echo "3. Set environment variables (DATABRICKS_WAREHOUSE_ID, etc.)"